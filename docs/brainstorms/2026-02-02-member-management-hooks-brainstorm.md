---
date: 2026-02-02
topic: member-management-hooks
---

# Member Management Hooks for DAO Spaces

## What We're Building

React hooks to manage DAO space membership through the new governance contracts. Four separate hooks that generate calldata for `SpaceRegistry.enter()` and write transactions to the chain:

1. **`useProposeAddMember`** - Propose adding a member to a DAO space
2. **`useProposeRemoveMember`** - Propose removing a member from a DAO space
3. **`useProposeAddEditor`** - Propose adding an editor to a DAO space
4. **`useProposeRemoveEditor`** - Propose removing an editor from a DAO space

**Scope:** Hooks only (calldata generation + chain writes). No UI work.

**Governance type:** DAO spaces only (PUBLIC). Personal spaces not in scope.

## Why This Approach

**Approaches considered:**

| Approach                 | Description                       | Verdict                                      |
| ------------------------ | --------------------------------- | -------------------------------------------- |
| A: Unified hook          | Single hook with action parameter | Rejected - prefer explicit separation        |
| **B: Separate hooks**    | Four distinct hooks               | **Chosen** - clearer, simpler per-hook logic |
| C: Composable primitives | Low-level building blocks         | Over-engineered for current needs            |

**Rationale:** Separate hooks are easier to understand, test, and maintain. Each action has clear intent at the call site.

## Key Decisions

### Contract Interaction Flow

All actions route through `SpaceRegistry.enter()`:

```
User Wallet → SpaceRegistry.enter() → DAOSpace.write() → _createProposal()
```

### Entry Point: SpaceRegistry.enter()

```solidity
function enter(
  bytes16 _fromSpaceId,    // Caller's personal space ID
  bytes16 _toSpaceId,      // Target DAO space ID
  bytes32 _action,         // PROPOSAL_CREATED
  bytes32 _topic,          // bytes32(0) - fetch() returns proposalId
  bytes calldata _data,    // Encoded proposal data
  bytes calldata _signature // Empty if caller owns fromSpace
)
```

### Data Encoding for PROPOSAL_CREATED

```solidity
abi.encode(
  proposalId,    // bytes16 - generated by hook
  votingMode,    // VotingMode enum (Fast = 0, Slow = 1)
  actions        // Action[] - array of {to, value, data}
)
```

Where each `Action` contains:

```solidity
struct Action {
  address to;    // DAOSpace address
  uint256 value; // 0 for member management
  bytes data;    // abi.encodeCall(IDAOSpace.addMember, (targetSpaceId))
}
```

### Proposal ID Generation

Hooks generate proposal IDs internally using randomness (e.g., `crypto.randomUUID()` converted to bytes16).

### Voting Mode Support

Both fast and slow paths supported. Caller specifies voting mode:

- **Fast path:** Single action, immediate execution on threshold, editors only
- **Slow path:** Multiple actions allowed, voting duration required, members or editors

### Action Constants

```typescript
const PROPOSAL_CREATED = keccak256('GOVERNANCE.PROPOSAL_CREATED')
// = 0x... (compute at implementation time)
```

### Fast Path Constraints

From contract analysis:

- `addMember` - valid for fast path
- `removeMember` - valid for fast path
- `addEditor` - NOT valid for fast path (must use slow)
- `removeEditor` - NOT valid for fast path (must use slow)

Hooks should validate and error if fast path requested for invalid actions.

## Hook Signatures (Draft)

```typescript
// useProposeAddMember
useProposeAddMember({
  callerSpaceId: `0x${string}`, // User's personal space
  daoSpaceId: `0x${string}`, // Target DAO space
  daoSpaceAddress: Address, // Contract address for Action.to
  targetMemberSpaceId: `0x${string}`, // Space to add as member
  votingMode: 'fast' | 'slow',
})

// Returns: { mutate, isPending, error, ... } (TanStack Query pattern)
```

Similar signatures for other hooks, with `targetMemberSpaceId` or `targetEditorSpaceId` as appropriate.

## Existing Infrastructure (Discovered)

**Already in place:**

- `SpaceRegistryAbi` and `DAOSpaceAbi` in `core/utils/contracts/space-registry.ts`
- `SPACE_REGISTRY_ADDRESS` constant
- `GOVERNANCE_ACTIONS.PROPOSAL_CREATED` and `MEMBERSHIP_REQUESTED` constants
- `VOTING_MODE.FAST` and `VOTING_MODE.SLOW` constants
- `encodeProposalCreatedData()` and `encodeMembershipRequestData()` helpers in `governance.ts`
- `useSmartAccountTransaction` hook for transaction execution
- `useRequestToBeEditor` as a reference pattern (uses PROPOSAL_CREATED with SLOW path)

**Files to replace:**

- `use-add-member.ts` - currently uses `PersonalSpaceAdminAbi.submitNewMember` (personal spaces only)
- `use-remove-member.ts` - needs inspection
- `use-add-editor.ts` - needs inspection
- `use-remove-editor.ts` - uses `MainVotingAbi.proposeRemoveEditor` (old DAO pattern)

**ABIs to update:**

- Need to add `removeMember` and `removeEditor` to `DAOSpaceAbi` in `space-registry.ts`

## Resolved Questions

1. **ABI availability:** ABIs are internal to the app in `core/utils/contracts/space-registry.ts`. Need to extend `DAOSpaceAbi` with remove functions.

2. **SpaceRegistry address:** Available as `SPACE_REGISTRY_ADDRESS` constant.

3. **Existing hooks:** Will be replaced entirely (not deprecated).

## Next Steps

-> `/workflows:plan` for implementation details
